<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Emotion Controller</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
      gap: 20px;
    }
    .column {
      border: 1px solid #ddd;
      padding: 12px;
      border-radius: 8px;
      width: 200px;
      text-align: center;
    }
    .column h2 {
      margin: 0 0 10px 0;
    }
    button {
      width: 100%;
      margin: 6px 0;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #f0f0f0;
    }
    button.active {
      background: #4caf50;
      color: white;
      border-color: #3e8e41;
    }
  </style>
</head>
<body>

  <div class="column" id="phone_1">
    <h2>Phone 1</h2>
    <button id="phone_1_happy" onclick="setEmotion('phone_1','happy')">Happy</button>
    <button id="phone_1_sad" onclick="setEmotion('phone_1','sad')">Sad</button>
    <button id="phone_1_angry" onclick="setEmotion('phone_1','angry')">Angry</button>
    <button id="phone_1_neutral" onclick="setEmotion('phone_1','neutral')">Neutral</button>
  </div>

  <div class="column" id="phone_2">
    <h2>Phone 2</h2>
    <button id="phone_2_happy" onclick="setEmotion('phone_2','happy')">Happy</button>
    <button id="phone_2_sad" onclick="setEmotion('phone_2','sad')">Sad</button>
    <button id="phone_2_angry" onclick="setEmotion('phone_2','angry')">Angry</button>
    <button id="phone_2_neutral" onclick="setEmotion('phone_2','neutral')">Neutral</button>
  </div>

  <div class="column" id="phone_3">
    <h2>Phone 3</h2>
    <button id="phone_3_happy" onclick="setEmotion('phone_3','happy')">Happy</button>
    <button id="phone_3_sad" onclick="setEmotion('phone_3','sad')">Sad</button>
    <button id="phone_3_angry" onclick="setEmotion('phone_3','angry')">Angry</button>
    <button id="phone_3_neutral" onclick="setEmotion('phone_3','neutral')">Neutral</button>
  </div>

  <div class="column" id="phone_4">
    <h2>Phone 4</h2>
    <button id="phone_4_happy" onclick="setEmotion('phone_4','happy')">Happy</button>
    <button id="phone_4_sad" onclick="setEmotion('phone_4','sad')">Sad</button>
    <button id="phone_4_angry" onclick="setEmotion('phone_4','angry')">Angry</button>
    <button id="phone_4_neutral" onclick="setEmotion('phone_4','neutral')">Neutral</button>
  </div>

<script>
  const phones = ["phone_1", "phone_2", "phone_3", "phone_4"];
  const emotions = ["happy", "sad", "angry", "neutral"];

  async function setEmotion(id, emotion) {
    await fetch("/emotion", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id, emotion })
    });

    // update highlight immediately
    updateHighlight(id, emotion);
  }

  async function pollState() {
    const res = await fetch("/state");
    const state = await res.json();

    phones.forEach(id => {
      const emotion = state[id]?.emotion || "neutral";
      updateHighlight(id, emotion);
    });
  }

  function updateHighlight(id, emotion) {
    emotions.forEach(e => {
      const btn = document.getElementById(`${id}_${e}`);
      if (btn) {
        btn.classList.toggle("active", e === emotion);
      }
    });
  }

  setInterval(pollState, 1000);
  pollState();
</script>

</body>
</html>
